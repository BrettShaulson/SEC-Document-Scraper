steps:
# 1)  Build inside ./backend
- name: gcr.io/cloud-builders/docker
  dir: backend
  args: ['build',
         '-t', 'gcr.io/$PROJECT_ID/${_SERVICE}:$SHORT_SHA',
         '.']

# 2)  ðŸ”¹ PUSH the image to Container/Artifact Registry
- name: gcr.io/cloud-builders/docker
  args: ['push', 'gcr.io/$PROJECT_ID/${_SERVICE}:$SHORT_SHA']

# 3)  Deploy to Cloud Run
- name: gcr.io/google.com/cloudsdktool/cloud-sdk
  entrypoint: gcloud
  args:
    - run
    - deploy
    - ${_SERVICE}
    - --image=gcr.io/$PROJECT_ID/${_SERVICE}:$SHORT_SHA
    - --region=${_REGION}
    - --platform=managed
    - --allow-unauthenticated
