substitutions:
  _SERVICE: sec-scraper
  _REGION:  us-central1

steps:
# 1) Build container FROM the backend directory
- name: gcr.io/cloud-builders/docker
  dir: backend                     # <── THIS LINE FIXES THE PATH ISSUE
  args: ['build',
         '-t', 'gcr.io/$PROJECT_ID/${_SERVICE}:$SHORT_SHA',
         '.']                      # context = ./backend

# 2) Deploy that image to Cloud Run
- name: gcr.io/google.com/cloudsdktool/cloud-sdk
  entrypoint: gcloud
  args:
    - run
    - deploy
    - ${_SERVICE}
    - --image=gcr.io/$PROJECT_ID/${_SERVICE}:$SHORT_SHA
    - --region=${_REGION}
    - --platform=managed
    - --allow-unauthenticated
    - --set-env-vars=PORT=8080

images:
- gcr.io/$PROJECT_ID/${_SERVICE}:$SHORT_SHA
